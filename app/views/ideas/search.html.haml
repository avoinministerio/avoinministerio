- content_for :head do
  %title= "Avoin Ministeriö ideat"
.grid_24.search-results
  %h1 
    Tulokset haulle
    %i= params['searchterm']
.grid_24.search
  .search
    Haku:
    = form_tag "/ideat/haku", :method => "get"
    = text_field_tag 'searchterm', params['searchterm']
    (esim. 
    %i tasa*
    tai 
    %i koira ja vero
    )
  - unless @ideas.empty?
    %h2 Ideat
    - @ideas.each do |idea|
      .search-result
        %a{:href => idea_path(idea)}
          != shorten_and_highlight(idea.title, params['searchterm'], 100, "«", "»")
  - unless @comments.empty?
    %h2 Kommentit
    - @comments.each do |comment|
      .search-result
        - case comment.commentable_type
        - when "Idea"
          %a{:href => idea_path(comment.commentable_id, :anchor => "comment_#{comment.id}")}
            != shorten_and_highlight(comment.body, params['searchterm'], 100, "«", "»")
        - else
          Tuntematon kommenttityyppi
          =comment.commentable_type
  -unless @articles.empty?
    %h2 Artikkelit
    - @articles.each do |article|
      .search-result
        %a{:href => article_path(article)}
          != shorten_and_highlight(article.title, params['searchterm'], 100, "«", "»")
  -unless @citizens.empty?
    %h2 Kansalaiset
    - @citizens.each do |citizen|
      .search-result-citizen
        %h3!= shorten_and_highlight(citizen.name, params['searchterm'], 100, "«", "»")
        - unless citizen.ideas.empty?
          %h4 Ideat:
          - citizen.ideas.each do |idea|
            %a{:href => idea_path(idea)}
              != shorten_and_highlight(idea.title, params['searchterm'], 100, "«", "»")
        - unless citizen.comments.empty?
          %h4 Kommentit:
          - citizen.comments.each do |comment|
            - case comment.commentable_type
            - when "Idea"
              %a{:href => idea_path(comment.commentable_id, :anchor => "comment_#{comment.id}")}
                != shorten_and_highlight(comment.body, params['searchterm'], 100, "«", "»")

.result-count
  - if @result_count == 1
    1 tulos
  - else
    = @result_count
    tulosta
  = will_paginate @results

- KM.identify(current_citizen)
:javascript
  var results = document.getElementsByClassName("search-result")
  for (var i=0;i<results.length;i++) {
    _kmq.push(['trackClick', results[i], "search result " + i + " clicked"])
  }