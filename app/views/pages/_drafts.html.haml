.container_24.top_drafts
  - filter = (section == 'proposal' ? 'law_proposals' : 'drafts')
  %h2=link_to "#{title} (#{count})", ideas_path(:filter => filter), :class => 'idea-heading-link'
  %div{class: "#{section}-section"}
    %ul{style: "list-style:none;"}
      - item_size = items.size
      - main_arr = [["grid_8", "alpha"], ["grid_8"], ["grid_8", "omega"]]
      - dup_arr = []
      - klass_arr = []
      - if section == 'proposal'
        - ((item_size/3) + 1).times { |i| dup_arr += main_arr }
        - klass_arr = dup_arr[0, item_size]
      - else
        - klass_arr = [["grid_8", "alpha"], ["grid_8"], ["grid_8", "omega"]][0, [3, items.size].min]

      - klass_arr.each_with_index do |klasses, i|
        %li{style: (item_size > 6) ? "margin-left:20px;" : "margin-left:10px"}
          %div{:class => klasses}
            - if recent_draft = items[i]
              .popular
                %h3.title=link_to shorten(recent_draft.title, 100, 20, "»"), idea_path(recent_draft), id: "ab_section_#{section}_#{i}_link"
                - if section == "proposal"
                  .collecting
                    Keräys: 
                    = recent_draft.collecting_start_date.strftime("%d.%m.%Y")
                    = '- '
                    = recent_draft.collecting_end_date.strftime("%d.%m.%Y")
                  %div{id: "draft_bar_#{section}_#{i+item_counter}", class: "bar"}
                    - favour_vote_per = [5, (260 * (Float(recent_draft.vote_count) / 50000)).ceil].max
                    - require_vote_per = [5, (260 * (Float(50000 - recent_draft.vote_count) / 50000)).ceil].max
                    :javascript
                      var t  = Raphael("draft_bar_#{section}_#{i+item_counter}", 260, 20);
                      t.rect(0, 0, #{[favour_vote_per,(300-40)].min}, 20).attr({fill: "#f0f0f0", stroke: "#fff", strokewidth: 5});
                      t.rect(#{[favour_vote_per,(260-40)].min}, 0, #{require_vote_per}, 20).attr({fill: "#f0f0f0", stroke: "#fff", strokewidth: 5});
                      var r  = Raphael("draft_bar_#{section}_#{i+item_counter}", 260, 20);
                      r.rect(0, 0, #{[favour_vote_per,(300-40)].min}, 20).attr({fill: "#52BD00", stroke: "#fff", strokewidth: 5});
                      r.rect(#{[favour_vote_per,(260-40)].min}, 0, #{require_vote_per}, 20).attr({fill: "#AEFC72", stroke: "#fff", strokewidth: 5});
                      t.text(20,11, "#{recent_draft.vote_count}").attr({"font-size": 12});
                      t.text(125,11, "/").attr({"font-size": 12});
                      t.text(235,11, "#{50000}").attr({"font-size": 12});
                - else
                  %div{id: "draft_bar_#{section}_#{i+item_counter}", class: "bar"}
                    - for_portion, for_, against_portion, against_ = recent_draft.stats
                    - for_length = [35, (280-5-35)*for_portion].max
                    :javascript
                      var r = Raphael("draft_bar_#{section}_#{i+item_counter}", 280, 20);
                      r.rect(  0, 0, #{for_length}, 20).attr({fill: "#8cc63f", stroke: "#fff", strokewidth: 5});
                      r.rect(#{for_length+5}, 0, #{280-5-for_length}, 20).attr({fill: "#a9003f", stroke: "#fff", strokewidth: 5});
                      r.text( 18,11, "#{for_}").attr({fill: "#fff", "font-size": 12});
                      r.text(261,11, "#{against_}").attr({fill: "#fff", "font-size": 12});                  

- if section == "proposal" && item_size > 6
  :javascript
    $(function() {
      $("div.proposal-section").carousel({
        dispItems: 3,
        autoSlide: true,
        combinedClasses: true,
        autoSlideInterval: 5000,
        delayAutoSlide: 1000
      });
    });
