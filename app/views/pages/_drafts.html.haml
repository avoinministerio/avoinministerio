.container_24.top_drafts
  - filter = (section == 'proposal' ? 'law_proposals' : 'drafts')
  %h2=link_to "#{title} (#{count})", ideas_path(:filter => filter), :class => 'idea-heading-link'
  %div{class: "#{section}-section"}
    %ul{style: "list-style:none;"}
      - item_size = items.size
      - main_arr = [["grid_8", "alpha"], ["grid_8"], ["grid_8", "omega"]]
      - dup_arr = []
      - klass_arr = []
      - if section == 'proposal'
        - ((item_size/3) + 1).times { |i| dup_arr += main_arr }
        - klass_arr = dup_arr[0, item_size]
      - else
        - klass_arr = [["grid_8", "alpha"], ["grid_8"], ["grid_8", "omega"]][0, [3, items.size].min]

      - klass_arr.each_with_index do |klasses, i|
        %li{style: (item_size > 6) ? "margin-left:20px;" : "margin-left:10px"}
          %div{:class => klasses}
            - if recent_draft = items[i]
              .popular
                %h3.title=link_to shorten(recent_draft.title, 100, 20, "Â»"), idea_path(recent_draft), id: "ab_section_#{section}_#{i}_link"
                - if section == "proposal"
                  %div{ :class => 'se-dates' }
                    %span
                      = recent_draft.collecting_start_date.strftime("%d.%m.%Y")
                    %span
                      %b
                        = '- '
                      = recent_draft.collecting_end_date.strftime("%d.%m.%Y")
                %div{id: "draft_bar_#{section}_#{i+item_counter}", class: "bar"}
                - for_portion, for_, against_portion, against_ = items_counts[recent_draft.id]
                - for_length = for_portion
                - for_var_green = for_
                - position_x = 18
                - position_y = 11
                - red_bar_x = 261
                - if section == "proposal"
                  - if for_portion < 20
                    - for_length = 25
                    - position_x = for_length+15
                  - for_var_green = ""
                  - green_length = (280-5-for_length)
                  - red_bar_x = (for_length-20) if green_length<30
                  - for_var_green = for_ if for_portion>30
                  - for_var_red = for_ if for_portion<30
                  - for_percentage = ""
                  - position_y = 11
                  - if for_portion > 80
                    - for_percentage = "#{(((280-for_portion).to_f/280)*100).to_i}"
                    - percentage_strings = "(%age left : "+"#{for_percentage}"+"%)"
                    - position_x = 65
                    - position_y = 10
                :javascript
                  var r = Raphael("draft_bar_#{section}_#{i+item_counter}", 280, 20);
                  r.rect(  0, 0, #{for_length}, 20).attr({fill: "#8cc63f", stroke: "#fff", strokewidth: 0});
                  r.rect(#{for_length+5}, 0, #{280-2-for_length}, 20).attr({fill: "#a9003f", stroke: "#fff", strokewidth: 0});
                  r.text( "#{position_x+2}","#{position_y}", "#{for_var_red} #{for_var_green} #{percentage_strings}").attr({fill: "#fff", "font-size": 12});
                  r.text("#{red_bar_x}",11, "#{against_}").attr({fill: "#fff", "font-size": 12});

- if section == "proposal" && item_size > 6
  :javascript
    $(function() {
      $("div.proposal-section").carousel({
        dispItems: 3,
        autoSlide: true,
        combinedClasses: true,
        autoSlideInterval: 5000,
        delayAutoSlide: 1000
      });
    });
